**프로젝트명: 오픈마켓**

**프로젝트 설명:** 서버로부터 상품의 정보를 받아와서 collection view를 통해 두가지 형태로 보여주고, 상품을 직접 앱 내에서 제작하여 서버로 업로드할 수 있는 앱

**진행기간: 2021/05/10 ~ 2021/05/28 (약 3주)**

**프로젝트 진행인원: 2인**

## 주요 학습 내용

- URLSession
- 비동기 프로그래밍
- HTTP 통신
- multipart/form-data를 통한 텍스트, 파일 업로드
- Protocol Oriented Programming을 통해 testable한 코드 작성하기
  - URLProtocol을 활용하여 네트워크 의존성이 없는 테스트 작성




## 주요 피드백과 개선내역

**Step1 PR 링크:** https://github.com/yagom-academy/ios-open-market/pull/25

**Step2 PR 링크:** https://github.com/yagom-academy/ios-open-market/pull/31

<br/>



## 프로젝트를 진행하며 느낀점

처음으로 네트워크 통신작업을 진행해보며 REST API의 개념, multipart/form-data의 구성방법, 인코딩과 디코딩의 개념 등 다양한 개념에 대해 학습했다. 동시에 Unit test에서 네트워크 의존성이 없는 테스트도 진행해보았다.

네트워킹 로직을 분리하며 코드의 구조에 대해 깊게 고민해보았고 testable한 코드를 만들기 위해 노력하다보니 자연스럽게 객체간의 커플링 문제가 해결되는 것도 알 수 있었다. 

야곰 아카데미에서 진행한 프로젝트 중 팀원과 가장 많은 대화를 한 



## 이후 리팩토링 내역

**2021.10.13**

> 안녕하세요! 갱신된 오픈마켓 API를 전달드립니다 
>
> 주요 변경사항은 아래와 같습니다. 
>
> 1. host 주소가 변경되었습니다 
> 2. 상품 리스트 조회에 search_value 쿼리가 추가되었습니다. 
> 3. 상품삭제를 위해 2번의 API를 거쳐야만 합니다(상품삭제 URI 조회 -> 상품삭제) 자세한 사항은 전달해드리는 API 명세를 참고해주시길 바랍니다. 아울러 기존 데이터는 리셋되었습니다. 
>
> API 이용에 필요한 벤더 정보도 함께 전달드리니 API를 참고하시어 이용바랍니다. {    "name": "secondVendor",    "accessId":"secondVendor",    "secret":"kbs111111",    "identifier": "9f12b7ca-4aa0-11ed-a200-83859d23efd1" }

다음과 같은 메세지를 전달받았고 API 명세서를 확인해보니 model쪽의 변경, encoding 로직의 변경도 필요했기에 리팩토링을 진행하면서 지난 프로젝트 진행 기간중에 완료하지 못한 구현을 진행하기로 했다.



### 이전 코드들의 문제점

- 난해한 네트워크 로직
  - 주어진 API 명세서에만 집중해 사용가능한 "모든" API call을 하나의 객체가 모두 해결하도록 하려다보니 인코딩과 관련한 로직, api 콜 로직 자체가 지나치게 복잡했었다.
  - 당시에 주어진 API 명세서가 이후에 변경될 가능성을 고려하지 않고 중복코드를 줄이는 것만 생각하다보니 생긴 결과였다.
- 일단 만들고 본 protocol들
  - 지나친 범용성을 추구하다보니 프로토콜을 과하게 많이 생성하여 사용했었다. 시간이 지나고 보면 난해한 코드도 많았고 무조건 범용성만 높인다고 좋은 코드가 되는 것이 아니라고 생각하게 되어 이 부분도 해결하는 시간을 가졌다.
- 컴플리션의 컴플리션의 컴플리션...
  - 비동기 처리 방법을 다양하게 알고있지 못하였기에 생긴 문제들이 종종 있었다.



### 해결한 방법

- 화면에 따른 폴더 분리를 진행한 뒤, 해당 화면이 사용하는 API관리 객체를 각 화면마다 만들어주었다.

  - 각 api콜마다 필요한 인자가 다르므로 모든걸 하나의 객체가 관리하기 보단 화면별로 이를 분리하였고 코드가 이전보다 훨씬 이해하기 쉬워졌다.

- dispatch group을 활용해 컴플리션 피라미드를 최대한 줄여보았다.

  